<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Climb the Everest</title>
  <link rel="stylesheet" href="./css/bodgethesquares.css">
  <link rel="stylesheet" href="./css/dark.css">
  <style>
    body {
      margin: 0;
      padding: 0;
    }
    canvas {
      background-image: url("./mont-everest-fond-blanc_908985-40370.jpg");
      background-repeat: no-repeat;
      background-size: cover;
      background-position: -150px;
      display: block;
      border: 2px solid white;
    }
    #click-btn, #restart {
      display: block;
      margin: 10px auto;
      padding: 10px 20px;
      font-size: 1.2rem;
    }
    #progression, #best, #timer {
      text-align: center;
      font-size: 1.2rem;
      color: white;
    }
    #shop {
      display: flex;
      gap: 50px;
      justify-content: center;
    }
    #shop div button {
      width: 400px;
    }
  </style>
</head>
<body>

<a href="index.html" style="
  position: fixed;
  bottom: 15px;
  left: 15px;
  background-color: #444;
  color: white;
  padding: 10px 15px;
  border-radius: 5px;
  text-decoration: none;
  font-family: Arial, sans-serif;
  z-index: 9999;
">🏠 Menu</a>

<h1>Extreme Climber!</h1>
<div id="theme-toggle-container">
  <button id="theme-toggle" class="dark">🌙 Mode sombre</button>
</div>
<h2>Boutique</h2>
<div id="shop" style="color:white; max-width: 300px;"></div>

<div id="timer">⏱️ Temps : 0s</div>
<canvas id="game" width="1000" height="800"></canvas>
<button id="click-btn">🖱️ Clique pour grimper !</button>
<div id="progression"></div>
<div id="best"></div>
<button id="restart" style="display:none;">🔄 Recommencer</button>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const clickBtn = document.getElementById("click-btn");
const progression = document.getElementById("progression");
const bestEl = document.getElementById("best");
const restartBtn = document.getElementById("restart");

const climberImg = new Image();
climberImg.src = "sticman.png";

const TOTAL_CLICKS = 8848;
let startTime = parseInt(localStorage.getItem("climb_start_time")) || Date.now();
let elapsedTime = parseInt(localStorage.getItem("climb_elapsed_time")) || 0;
let timerInterval = null;
let bestTime = parseInt(localStorage.getItem("climb_best_time")) || null;

let doubleClickActive = false;
let autoClickInterval1 = null;
let autoClickInterval2 = null;
let currentClicks = parseInt(localStorage.getItem("climb_clicks")) || 0;
let climberY = canvas.height - 40;
let clickHistory = [];
let flipped = false; // ➕ Pour effet miroir

function formatTime(ms) {
  const totalSeconds = Math.floor(ms / 1000);
  const hours = Math.floor(totalSeconds / 3600);
  const minutes = Math.floor((totalSeconds % 3600) / 60);
  const seconds = totalSeconds % 60;
  return `${hours}H ${minutes}M ${seconds}S`;
}

function startTimer() {
  if (timerInterval) return;
  startTime = Date.now() - elapsedTime;
  timerInterval = setInterval(() => {
    elapsedTime = Date.now() - startTime;
    document.getElementById("timer").textContent = `⏱️ Temps : ${formatTime(elapsedTime)}`;
    localStorage.setItem("climb_elapsed_time", elapsedTime);
    localStorage.setItem("climb_start_time", startTime);
  }, 1000);
}

function drawClimber() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  const climberWidth = 30;
  const climberHeight = 30;
  const climberX = canvas.width / 2 + 70;

  ctx.save();
  if (flipped) {
    ctx.translate(climberX + climberWidth / 2, 0);
    ctx.scale(-1, 1);
    ctx.drawImage(climberImg, -climberWidth / 2, climberY, climberWidth, climberHeight);
  } else {
    ctx.drawImage(climberImg, climberX, climberY, climberWidth, climberHeight);
  }
  ctx.restore();
}

function updateProgress() {
  const percent = Math.min((currentClicks / TOTAL_CLICKS) * 100, 100);
  progression.textContent = `Progression : ${currentClicks} / ${TOTAL_CLICKS} (${Math.floor(percent)}%)`;

  const bottomY = canvas.height - 20;
  const topY = 40;
  climberY = bottomY - ((bottomY - topY) * (currentClicks / TOTAL_CLICKS));

  drawClimber();

  if (currentClicks >= TOTAL_CLICKS) {
    clickBtn.disabled = true;
    progression.textContent += " 🏔️ Tu as atteint le sommet !";
    restartBtn.style.display = "inline-block";
    clearInterval(timerInterval);

    if (!bestTime || elapsedTime < bestTime) {
      bestTime = elapsedTime;
      localStorage.setItem("climb_best_time", bestTime);
    }

    bestEl.textContent = `Meilleur temps : ${Math.floor(bestTime / 1000)}s`;
  }
}

clickBtn.addEventListener("click", () => {
  const now = Date.now();
  clickHistory = clickHistory.filter(t => now - t < 1000);
  if (clickHistory.length >= 15) {
    alert("Tu cliques trop vite poto ! Max 5/sec 🧤");
    return;
  }

  clickHistory.push(now);
  let increment = doubleClickActive ? 2 : 1;
  currentClicks += increment;
  flipped = !flipped; // ➕ Inverse à chaque clic

  localStorage.setItem("climb_clicks", currentClicks);
  if (currentClicks >= TOTAL_CLICKS && !timerInterval) clearInterval(timerInterval);
  updateProgress();
  renderShop();
});

restartBtn.addEventListener("click", () => {
  currentClicks = 0;
  localStorage.setItem("climb_clicks", currentClicks);
  startTime = Date.now();
  elapsedTime = 0;
  localStorage.setItem("climb_start_time", startTime);
  localStorage.setItem("climb_elapsed_time", 0);
  clearInterval(timerInterval);
  timerInterval = null;
  clickBtn.disabled = false;
  restartBtn.style.display = "none";
  updateProgress();
  startTimer();
});

const shopItems = [
  {
    id: "doubleClick",
    name: "Double Clic",
    description: "Chaque clic compte double",
    cost: 400,
    effect: () => { doubleClickActive = true; }
  },
  {
    id: "autoClick",
    name: "1 clic /2s",
    description: "Ajoute 1 clic par seconde",
    cost: 1000,
    effect: () => {
      if (!autoClickInterval1) {
        autoClickInterval1 = setInterval(() => {
          currentClicks++;
          localStorage.setItem("climb_clicks", currentClicks);
          updateProgress();
        }, 2000);
      }
    }
  },
  {
    id: "autoClick2",
    name: "2 clic /2s",
    description: "Ajoute 1 clic par seconde",
    cost: 1800,
    effect: () => {
      if (!autoClickInterval2) {
        autoClickInterval2 = setInterval(() => {
          currentClicks += 2;
          localStorage.setItem("climb_clicks", currentClicks);
          updateProgress();
        }, 2000);
      }
    }
  }
];

let purchasedItems = JSON.parse(localStorage.getItem("climb_purchases")) || [];

function renderShop() {
  const shopContainer = document.getElementById("shop");
  shopContainer.innerHTML = "";
  shopItems.forEach(item => {
    const bought = purchasedItems.includes(item.id);
    const button = document.createElement("button");
    button.textContent = `${item.name} (${item.cost} clics)`;
    button.disabled = bought || currentClicks < item.cost;
    button.title = item.description;
    button.addEventListener("click", () => {
      if (currentClicks >= item.cost && !bought) {
        currentClicks -= item.cost;
        item.effect();
        purchasedItems.push(item.id);
        localStorage.setItem("climb_purchases", JSON.stringify(purchasedItems));
        localStorage.setItem("climb_clicks", currentClicks);
        updateProgress();
        renderShop();
      }
    });
    if (!bought) {
      const itemDiv = document.createElement("div");
      itemDiv.appendChild(button);
      shopContainer.appendChild(itemDiv);
    }
  });
}

drawClimber();
updateProgress();
renderShop();
purchasedItems.forEach(id => {
  const item = shopItems.find(i => i.id === id);
  if (item) item.effect();
});
startTimer();
</script>

<script src="./js/dark.js"></script>
<script src="./js/stealth.js"></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2810189862013244"
     crossorigin="anonymous"></script>
<script type="text/javascript">
	atOptions = {
		'key' : 'c86e387157f60d5125b9bd69ed6b7980',
		'format' : 'iframe',
		'height' : 60,
		'width' : 468,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/c86e387157f60d5125b9bd69ed6b7980/invoke.js"></script>

</body>
</html>
